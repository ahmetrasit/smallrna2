<div class="modal fade" id="newDatasetModal" tabindex="-1" role="dialog" aria-labelledby="Add New Dataset" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addDatasetTitle">Add New Dataset</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-12 text-center">
            <p class="lead">Upload <b>.fastq.gz files</b></p>
            <div class="input-group mb-3">
              <div class="custom-file">
                <input type="file" class="custom-file-input" id="fileupload" multiple>
                <label class="custom-file-label" for="fileupload">Choose file(s)</label>
              </div>
            </div>
          </div>
        </div>
        <div class="row" id="debarcodingSelection">
          <div onclick="needsDebarcoding()" class="jumbotron col-md-6 bg-white text-center jumbotron-link text-black-50">
            <h1 class="display-5">Needs Debarcoding</h1>
            <p class="lead">Upload FASTQ files</p>
          </div>
          <div onclick="noDebarcoding()" class="jumbotron col-md-6 bg-white text-center jumbotron-link text-black-50">
            <h1 class="display-5">No Need to Debarcode</h1>
            <p class="lead">Use already debarcoded data / files</p>
          </div>
        </div>
        <div class="row d-none" id="new_dataset_info">
          <div class="col-md-12">
            <div class="row">
              <div class="form-group col-md-4">
                <input type="text" name="new_dataset_name" id="new_dataset_name" class="form-control" required autofocus maxlength="128">
                <label class="form-control-placeholder" for="new_dataset_name">Dataset Name</label>
              </div>
              <div class="form-group col-md-8">
                <input name="new_dataset_description" id="new_dataset_description" class="form-control" required/>
                <label class="form-control-placeholder" for="new_dataset_description">Description</label>
              </div>
            </div>
          </div>
        </div>

        <div class="row d-none" id="needsDebarcoding">
            <div class="col-md-12 no-file-uploaded">
                <div class="bg-danger text-white text-center lead rounded">Please upload .fastq.gz file(s) first.</div>
            </div>
        </div>
        <div class="row mt-4" id="needsDebarcoding">
            <div class="form-group col-md-3">
                <input type="text" name="new_dataset_barcode" id="new_dataset_barcode" class="form-control" required maxlength="32">
                <label class="form-control-placeholder" for="new_dataset_barcode">Barcode</label>
            </div>
            <div class="form-group col-md-3">
                <input type="text" name="new_dataset_sample_name" id="new_dataset_sample_name" class="form-control" required maxlength="32">
                <label class="form-control-placeholder" for="new_dataset_sample_name">Sample Name</label>
            </div>
            <div class="form-group col-md-5">
                <input type="text" name="new_dataset_sample_description" id="new_dataset_sample_description" class="form-control" required/>
                <label class="form-control-placeholder" for="new_dataset_sample_description">Sample Description</label>
            </div>
            <div class="form-group col-md-1">
                <button class="btn form-control text-white bg-success"><span class="">+</span></button>
            </div>
        </div>

        <div class="row d-none" id="noDebarcoding">
            <div class="col-md-12 no-file-uploaded">
                <div class="bg-danger text-white text-center lead">Please upload .fastq.gz file(s) first.</div>
            </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<script>
  $('#newDatasetModal').on('hidden.bs.modal', function (e) {
      console.log('hidden');
      $('#debarcodingSelection').addClass('d-flex')
      $('#needsDebarcoding').removeClass('d-flex').addClass('d-none')
      $('#noDebarcoding').removeClass('d-flex').addClass('d-none')
      $('#new_dataset_info').removeClass('d-flex').addClass('d-none')
})

  function needsDebarcoding() {
      $('#debarcodingSelection').removeClass('d-flex').addClass('d-none')
      $('#needsDebarcoding').addClass('d-flex')
      $('#new_dataset_info').addClass('d-flex')
  }

  function noDebarcoding() {
      $('#debarcodingSelection').removeClass('d-flex').addClass('d-none')
      $('#noDebarcoding').addClass('d-flex')
      $('#new_dataset_info').addClass('d-flex')
  }

  $('#fileupload').change(function(d){
      var fileNames = [];
      var fileListTemp= $('#fileupload').prop('files')
      for(var i = 0; i<fileListTemp['length']; i++){
          console.log(fileListTemp[i].name, fileListTemp[i].type)
          if(fileListTemp[i].name.match(/.fastq.gz$/)){
              console.log('match', fileListTemp[i].name)
              fileNames.push(fileListTemp[i].name)
          }
      }

      if(fileNames.length > 0){
          $('#barcodes').removeClass('d-none').addClass('d-flex')
          $('.no-file-uploaded').removeClass('d-flex').addClass('d-none')
      }
      else {
          $('#barcodes').removeClass('d-flex').addClass('d-none')
          $('.no-file-uploaded').removeClass('d-none').addClass('d-flex')
      }
  })
</script>